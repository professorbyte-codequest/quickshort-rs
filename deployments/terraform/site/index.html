<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QuickShort — URL shortener for CodeQuestHub</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        margin: 0;
        color: #0f172a;
        background: #f8fafc;
      }
      .wrap {
        max-width: 720px;
        margin: 10vh auto;
        padding: 0 20px;
      }
      h1 {
        font-size: 2.2rem;
        margin: 0 0 0.5rem;
      }
      p {
        line-height: 1.6;
        font-size: 1.05rem;
      }
      .cta {
        margin-top: 1.5rem;
        display: inline-block;
        background: #0ea5e9;
        color: white;
        padding: 10px 16px;
        border-radius: 10px;
        text-decoration: none;
      }
      .muted {
        color: #475569;
      }
    </style>
    <script src="/auth/config.js"></script>
    <script src="/auth/auth.js"></script>
  </head>
  <body>
    <main class="wrap">
      <h1>QuickShort</h1>
      <p class="muted">
        A fast, Rust-powered URL shortener fronted by CloudFront. This is our
        minimal landing page.
      </p>
      <p>
        A public preview is coming soon — we’re tuning caching, auth, and costs
        so we don’t melt our DynamoDB bill.
      </p>
      <p id="out" style="background:#f6f8fa;padding:1rem;border-radius:.5rem;"></p>
      <p>
        If you’re part of the team, head to the
        <a class="cta" href="/admin/">Admin Console →</a>
      </p>
    </main>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-6RN700Z4QW"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "{{ site.google_analytics }}");
    </script>

  <script>
    (async () => {
      const out = document.getElementById('out');
      try {
        // ensure we have an ID token
        const idt = localStorage.getItem('qs_id_token');
        if (!idt) {
          // no token: send them to sign-in
          out.innerHTML = '<a href="/auth/signin">Sign in</a>';
          return;
        }
        // call API with Authorization header (added by qsApi)
        const r = await QSAuth.qsApi('/v1/admin/me');
        if (r.ok) {
          const j = await r.json();
          out.textContent = "Hello, " + j.email;
        } else {
          console.log('me API error', r.status, r.json());
          out.innerHTML = '<a href="/auth/signin">Sign in</a>';
        }
      } catch (e) {
        out.innerHTML = '<a href="/auth/signin">Sign in</a>';
      }
    })();
  </script>
  </body>
</html>
